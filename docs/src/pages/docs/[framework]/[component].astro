---
import DocsLayout from '../../../layouts/DocsLayout.astro'
import { Text } from '../../../components/shared/Text'
import { Heading } from '../../../components/shared/Heading'
import { ComponentSidebar } from '../../../components/navigation/ComponentSidebar'

export async function getStaticPaths() {
  const allFiles = await Astro.glob('../../../../../packages/*/src/**/docs/**/*.mdx')
  const allDocs = allFiles.map((doc) => ({
    doc,
    framework: doc.file.match(/\/packages\/(\w+)\/src/)[1],
    component: doc.file.match(/docs\/(.*)\.mdx$/)[1],
  }))

  const byFramework = allDocs.reduce((acc, docData) => {
    if (!acc[docData.framework]) {
      acc[docData.framework] = []
    }
    acc[docData.framework].push(docData)
    return acc
  }, {})

  return allDocs.map(({ doc, framework, component }) => {
    return {
      params: {
        component,
        framework,
      },
      props: {
        doc,
        sidebarItems: byFramework[framework],
        component,
        framework,
      },
    }
  })
}

const {
  doc: { Content, frontmatter },
  component,
  framework,
  sidebarItems,
} = Astro.props
---

<DocsLayout frontmatter={frontmatter}>
  <ComponentSidebar
    slot="components"
    framework={framework}
    component={component}
    items={sidebarItems}
  />
  <Content components={{ h1: Heading, p: Text }} />
</DocsLayout>
